---
title: "Exploring the Simpson's Paradox within the Penguin Dataset"
subtitle: "and demonstrating the capabilities of quarto"
description: "this document is an analysis of the penguin dataset. it explores the relationship between bill length and depth and shows how important it is to consider group effects."
title-block-banner: "#ced3c5"
title-block-banner-color: "black"

author:
  name: "Sofie Costin"
  affiliation: "Frontiers of Restoration Ecology Lab, Flinders University"
  email: "sofie.costin@flinders.edu.au"

keywords: "quarto, data analysis, paradox"
date: today
format: 
  html:
    toc: true
    number-sections: true
    code-fold: true
    code-summary: "Show the code"
css: styles.css
editor: visual
---

::: callout-important
This is for practicing code for the Productive R Workflow Course by Yan Holz.
:::

## Introduction

Data originally from [here](https://github.com/holtzy/productive-r-workflow-homework-solution/blob/main/read-from-excel/input/data.xlsx)

## Data

**Load** the penguin data and set working directory, libraries, and functions.

```{r, warning=FALSE, message=FALSE}
#| label: load-penguin-data


# load the tidyverse
library(tidyverse)
library(hrbrthemes)     # ipsum theme for ggplot2 charts
library(patchwork)      # combine charts together
library(DT)             # creates interactive datatables
library(knitr)          # generate clean tables
library(plotly)         # interactive plots



# Source functions
source(file="R/functions.R")

# Read the clean dataset
data <- readRDS(file = "input/clean_data.rds")


# Convert relevant columns to numeric
data <- data %>%
  mutate(
    bill_length_mm     = as.numeric(bill_length_mm),
    bill_depth_mm      = as.numeric(bill_depth_mm),
    flipper_length_mm  = as.numeric(flipper_length_mm),
    body_mass_g        = as.numeric(body_mass_g)
  )

# Summary
datatable(data, filter = "top")
```

![Bill measurement explanation](R/assets/culmen_depth.png){fig-alt="Explanation of bill measurements" fig-align="left" width="300"}

## Bill length and depth

Assessing the relationship between **bill length** and **bill depth**

```{r, fig.align = "center", fig.width=5, fig.height=5, warning=FALSE, fig.cap="Relationship between bill <b>length</b> and bill <b>depth</b>. <b>All</b> data points included."}

# visualise with ggplot 

p <- data %>%
  ggplot(
    aes(x = bill_length_mm, y = bill_depth_mm)
  ) +
    geom_point(color="#69b3a2") +
    labs(
      x = "Bill Length (mm)",
      y = "Bill Depth (mm)",
      title = paste("Bill length x depth")
    ) + 
  theme_ipsum()

ggplotly(p)
```

It is also interesting to note that `bill length` and `bill depth` are quite different from one species to another.

```{r, warning = FALSE}
#| layout-ncol: 2

bill_summary <- data %>% 
  dplyr::group_by(species) %>% 
  dplyr::summarise(average_bill_length = mean(bill_length_mm, na.rm = TRUE),
                   average_bill_depth = mean(bill_depth_mm, na.rm = TRUE)
  )


kable(bill_summary)


```

Split by species:

```{r, warning=FALSE, fig.height=3, fig.width=9, fig.cap="There is actually a positive correlation when split by species."}

# Use the function in functions.R
p1 <- create_scatterplot(data, "Adelie", "#6689c6")
p2 <- create_scatterplot(data, "Chinstrap", "#e85252")
p3 <- create_scatterplot(data, "Gentoo", "#9a6fb0")

p1 + p2 + p3
```
